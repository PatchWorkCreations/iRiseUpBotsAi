
{% load static %}                           
<head>
    <script type="text/javascript" src="https://web.squarecdn.com/v1/square.js"></script>
</head>

<section id="pricing" class="pricing-section">
    <div class="container">
        <h2 class="pricing-title">üí∞ Simple & Transparent Pricing</h2>
        <p class="pricing-subtext">No hidden fees, no surprises‚Äîjust powerful AI at your fingertips.</p>

        <div class="pricing-container">
             
            <div class="pricing-card free-plan">
                <h3>üöÄ Start for Free ‚Äì No Risk!</h3>
                <p class="price free-text">Free <span class="small-text">‚Äì Your AI Trial Awaits!</span></p>
                <ul class="pricing-features">
                    <li><i class="fas fa-check-circle"></i> Limited AI Access ‚Äì Try AI power</li>
                    <li><i class="fas fa-check-circle"></i> Up to 8 Chats/Day ‚Äì Great for casual use</li>
                    <li><i class="fas fa-check-circle"></i> 1 AI Assistant ‚Äì Meet Lumos, your first AI guide</li>
                </ul>
                <a href="{% url 'signup' %}" class="btn btn-secondary">Try for Free</a>
            </div>

             
            <div class="pricing-card pro-plan standout">
                <div class="badge most-popular">üî• Most Popular</div>
                <h3>üí° Pro Plan ‚Äì Your AI Powerhouse</h3>
                <p class="price">$20<span class="price-month">/month</span></p>
                <span class="highlighted-badge">Max AI Power Unlocked</span>
                <ul class="pricing-features">
                    <li><i class="fas fa-check-circle"></i> Full AI Access (All 8 Assistants)</li>
                    <li><i class="fas fa-check-circle"></i> Unlimited Chats ‚Äì No limits, ask anytime</li>
                    <li><i class="fas fa-check-circle"></i> Priority Support ‚Äì AI + Human help</li>
                </ul>
                <a href="#" class="btn btn-primary standout-btn open-checkout" data-plan="pro" data-price="$20/month">üöÄ Unlock Full AI Access</a>
            </div>
            

               
            <div class="pricing-card one-year-plan">
                <h3>üèÜ 1-Year Access ‚Äì Best Long-Term Value!</h3>
                <p class="price">
                    <span class="discounted-price">$127</span> 
                    <span class="original-price">$468</span> 
                    <span class="savings-badge">You Save 73%!</span>
                </p>
                <ul class="pricing-features">
                    <li><i class="fas fa-check-circle"></i> Full AI Access for 12 Months</li>
                    <li><i class="fas fa-check-circle"></i> No Monthly Fees ‚Äì Pay once, enjoy a year</li>
                    <li><i class="fas fa-check-circle"></i> All Future Updates Included</li>
                    <li><i class="fas fa-check-circle"></i> Priority Customer Support</li>
                </ul>
                <a href="#" class="btn btn-primary open-checkout" data-plan="one-year" data-price="$127 one-time">Get 1-Year Access & Save!</a>
                
            </div>
        </div>

        <p class="money-back">‚úîÔ∏è 14-Day Money-Back Guarantee ‚Äì Try any plan risk-free!</p>
    </div>
</section>
 <!-- Checkout Modal -->
<!-- Checkout Modal -->
<div id="checkout-modal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close-modal">&times;</span>
            <h2>Checkout</h2>
        </div>

        <h3><span style="color: #5860F8;">91% of users</span> are satisfied with the plan and stay with us after its completion</h3>

        <!-- Payment Form (Visible Immediately) -->
        <div id="card-payment">
            <h3 style="text-align: center;">Pay with Card</h3>

            <div class="card-icons" style="text-align: center;">
                <img src="{% static 'myapp/images/card_icons/1.svg' %}" alt="Card Icon 1" />
                <img src="{% static 'myapp/images/card_icons/2.svg' %}" alt="Card Icon 2" />
                <img src="{% static 'myapp/images/card_icons/3.svg' %}" alt="Card Icon 3" />
                <img src="{% static 'myapp/images/card_icons/4.svg' %}" alt="Card Icon 4" />
                <img src="{% static 'myapp/images/card_icons/5.svg' %}" alt="Card Icon 5" />
                <img src="{% static 'myapp/images/card_icons/6.svg' %}" alt="Card Icon 6" />
            </div>

            <div class="form-container">
                <h2>Fill Out Your Information</h2>
                <form id="payment-form">
                    <input type="hidden" id="selected-plan" name="plan">

                    <div class="form-group">
                        <label for="givenName">First Name</label>
                        <input type="text" id="givenName" name="givenName" placeholder="e.g. John" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="familyName">Last Name</label>
                        <input type="text" id="familyName" name="familyName" placeholder="e.g. Doe" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="addressLine1">Address Line 1</label>
                        <input type="text" id="addressLine1" name="addressLine1" placeholder="e.g. 1234 Elm Street" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" id="city" name="city" placeholder="e.g. New York" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <input type="text" id="state" name="state" placeholder="e.g. NY" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="countryCode">Country Code</label>
                        <select id="countryCode" name="countryCode" class="form-control select2" required>
                            <option value="" disabled selected>Select a country code</option>
                            <option value="US">United States (+1)</option>
                            <option value="CA">Canada (+1)</option>
                            <option value="GB">United Kingdom (+44)</option>
                            <option value="AU">Australia (+61)</option>
                            <option value="IN">India (+91)</option>
                            <option value="DE">Germany (+49)</option>
                            <option value="FR">France (+33)</option>
                            <option value="PH">Philippines (+63)</option>
                            <option value="JP">Japan (+81)</option>
                            <option value="CN">China (+86)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="text" id="phone" name="phone" placeholder="e.g. +1 234 567 8900 (US)" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" placeholder="e.g. yourname@example.com" class="form-control" required>
                    </div>

                    <div id="card-container" class="form-group"></div>
                    <button id="pay-now-btn" type="submit" class="btn-submit">Pay Now</button>
                    <div id="loader" class="loader" style="display: none;"></div>
                    <p id="processing-message" class="processing-message" style="display: none;">Processing your payment...</p>
                </form>
                 
                
            </div>
        </div>
    </div>
</div>

<script>
    // Square Payment  
document.addEventListener("DOMContentLoaded", async function () {
    console.log("‚úÖ JavaScript loaded!");

    const openCheckoutButtons = document.querySelectorAll(".open-checkout");
    const checkoutModal = document.getElementById("checkout-modal");
    const closeModalButton = document.querySelector(".close-modal");
    const payNowButton = document.getElementById("pay-now-btn");
    const selectedPlanInput = document.getElementById("selected-plan");

    let squareInitialized = false;
    let card;

    if (!checkoutModal) {
        console.error("‚ùå Checkout modal not found!");
        return;
    }

    // ‚úÖ Open checkout modal
    openCheckoutButtons.forEach(button => {
        button.addEventListener("click", function (event) {
            event.preventDefault();
            console.log("üí≥ Checkout button clicked!");

            const selectedPlan = this.getAttribute("data-plan");
            selectedPlanInput.value = selectedPlan;
            checkoutModal.style.display = "flex";

            setupSquarePayments();
        });
    });

    // ‚úÖ Close modal
    closeModalButton.addEventListener("click", function () {
        checkoutModal.style.display = "none";
    });

    async function setupSquarePayments() {
        if (squareInitialized) return;

        console.log("üîÑ Initializing Square Payments...");

        try {
            const payments = Square.payments("sq0idp-jpJ9YFYpLwuh5nFx4B-qXg", "45B8XGXSPP8E3");
            card = await payments.card();
            await card.attach("#card-container");

            console.log("‚úÖ Card attached to container!");
            squareInitialized = true;

            payNowButton.addEventListener("click", async function (event) {
                event.preventDefault();
                await processPayment();
            });

        } catch (error) {
            console.error("‚ö†Ô∏è Square Payment Initialization Error:", error);
        }
    }

    async function processPayment() {
        try {
            payNowButton.disabled = true;

            const result = await card.tokenize();
            if (result.status !== "OK") {
                alert("Payment failed: " + result.errors[0].message);
                payNowButton.disabled = false;
                return;
            }

            console.log("‚úÖ Payment token generated!");

            const response = await fetch("/process-ai-subscription/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                body: JSON.stringify({
                    source_id: result.token,
                    plan: selectedPlanInput.value,
                    givenName: document.getElementById("givenName").value,
                    familyName: document.getElementById("familyName").value,
                    addressLine1: document.getElementById("addressLine1").value,
                    city: document.getElementById("city").value,
                    state: document.getElementById("state").value,
                    countryCode: document.getElementById("countryCode").value,
                    phone: document.getElementById("phone").value,
                    email: document.getElementById("email").value,
                }),
            });

            const jsonResult = await response.json();

            if (jsonResult.success) {
                window.location.href = "/success/";
            } else {
                alert(jsonResult.error);
            }
        } catch (error) {
            console.error("‚ö†Ô∏è Payment Error:", error);
            alert("Payment failed: " + error.message);
        } finally {
            payNowButton.disabled = false;
        }
    }
});


</script>