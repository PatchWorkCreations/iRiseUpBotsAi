{% load static %}

<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="Responsive Admin Dashboard Template" name="description"/>
  <meta content="admin,dashboard" name="keywords"/>
  <meta content="stacks" name="author"/>
  <!-- The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <!-- Title -->
  <title>
   iRiseUp - Responsive Admin Dashboard Template
  </title>
  <!-- Styles -->
  <link href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/plugins/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/plugins/perfectscroll/perfect-scrollbar.css' %}" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/plugins/pace/pace.css' %}" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/plugins/highlight/styles/github-gist.css' %}" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/plugins/select2/css/select2.min.css' %}" rel="stylesheet"/>
  <!-- Theme Styles -->
  <link href="{% static 'ai_integration2/css/main.min.css' %}" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/css/custom.css' %}" rel="stylesheet"/>
  <link href="{% static 'ai_integration2/images/iriseup.png' %}" rel="icon" sizes="32x32" type="image/png">
   <link href="{% static 'ai_integration2/images/iriseup.png' %}" rel="icon" sizes="16x16" type="image/png">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
   </link>
  </link>
 </head>
 <style>
  .chat-widget-preview {
    width: 360px;
    height: 520px;
    border-radius: 12px;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    font-family: 'Segoe UI', sans-serif;
    margin: 0 auto;
  }
  .chat-widget-preview.light {
    background: #fff;
    color: #000;
  }
  .chat-widget-preview.dark {
    background: #1e1e1e;
    color: #fff;
  }
  .chat-header {
    padding: 12px 16px;
    background-color: #025450;
    color: #fff;
    font-weight: 600;
  }
  .chat-body {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .bot-message {
    background: #f1f1f1;
    color: #000;
    align-self: flex-start;
    padding: 10px 14px;
    border-radius: 20px;
    max-width: 80%;
  }
  .user-message {
    background: #d1f3f0;
    color: #000;
    align-self: flex-end;
    padding: 10px 14px;
    border-radius: 20px;
    max-width: 80%;
  }
  .chat-footer {
    display: flex;
    border-top: 1px solid #ddd;
    padding: 10px;
    background: inherit;
  }
  .chat-footer input {
    flex: 1;
    border: none;
    padding: 8px;
    border-radius: 20px;
    outline: none;
    background: #f9f9f9;
  }
  .chat-footer button {
    margin-left: 8px;
    background: #025450;
    color: #fff;
    border: none;
    padding: 8px 14px;
    border-radius: 20px;
    cursor: pointer;
  }
  .bottom-right {
    margin-left: auto;
  }
  .bottom-left {
    margin-right: auto;
  }
</style>
 <body>
   <div class="app align-content-stretch d-flex flex-wrap">
    {% include 'myapp/ai_integration/includes/sidebar.html' %}

   <div class="app-container">
    <div class="search">
     <form>
      <input aria-label="Search" class="form-control" placeholder="Type here..." type="text"/>
     </form>
     <a class="toggle-search" href="#">
      <i class="material-icons">
       close
      </i>
     </a>
    </div>
    <div class="app-header">
     <nav class="navbar navbar-light navbar-expand-lg">
      <div class="container-fluid">
       <div class="navbar-nav" id="navbarNav">
        <ul class="navbar-nav">
         <li class="nav-item">
          <a class="nav-link hide-sidebar-toggle-button" href="#">
           <i class="material-icons">
            first_page
           </i>
          </a>
         </li>
         <li class="nav-item dropdown hidden-on-mobile">
          <a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="addDropdownLink" role="button">
           <i class="material-icons">
            add
           </i>
          </a>
          <ul aria-labelledby="addDropdownLink" class="dropdown-menu">
           <li>
            <a class="dropdown-item" href="#">
             New Workspace
            </a>
           </li>
           <li>
            <a class="dropdown-item" href="#">
             New Board
            </a>
           </li>
           <li>
            <a class="dropdown-item" href="#">
             Create Project
            </a>
           </li>
          </ul>
         </li>
         <li class="nav-item dropdown hidden-on-mobile">
          <a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="exploreDropdownLink" role="button">
           <i class="material-icons-outlined">
            explore
           </i>
          </a>
          <ul aria-labelledby="exploreDropdownLink" class="dropdown-menu dropdown-lg large-items-menu">
           <li>
            <h6 class="dropdown-header">
             Repositories
            </h6>
           </li>
           <li>
            <a class="dropdown-item" href="#">
             <h5 class="dropdown-item-title">
              iRiseUp iOS
              <span class="badge badge-warning">
               1.0.2
              </span>
              <span class="hidden-helper-text">
               switch
               <i class="material-icons">
                keyboard_arrow_right
               </i>
              </span>
             </h5>
             <span class="dropdown-item-description">
              Lorem Ipsum is simply dummy text of the printing and typesetting industry.
             </span>
            </a>
           </li>
           <li>
            <a class="dropdown-item" href="#">
             <h5 class="dropdown-item-title">
              iRiseUp Android
              <span class="badge badge-info">
               dev
              </span>
              <span class="hidden-helper-text">
               switch
               <i class="material-icons">
                keyboard_arrow_right
               </i>
              </span>
             </h5>
             <span class="dropdown-item-description">
              Lorem Ipsum is simply dummy text of the printing and typesetting industry.
             </span>
            </a>
           </li>
           <li class="dropdown-btn-item d-grid">
            <button class="btn btn-primary">
             Create new repository
            </button>
           </li>
          </ul>
         </li>
        </ul>
       </div>
       <div class="d-flex">
        <ul class="navbar-nav">
         <li class="nav-item hidden-on-mobile">
          <a class="nav-link active" href="#">
           Applications
          </a>
         </li>
         <li class="nav-item hidden-on-mobile">
          <a class="nav-link" href="#">
           Reports
          </a>
         </li>
         <li class="nav-item hidden-on-mobile">
          <a class="nav-link" href="#">
           Projects
          </a>
         </li>
         <li class="nav-item">
          <a class="nav-link toggle-search" href="#">
           <i class="material-icons">
            search
           </i>
          </a>
         </li>
         <li class="nav-item hidden-on-mobile">
          <a class="nav-link language-dropdown-toggle" data-bs-toggle="dropdown" href="#" id="languageDropDown">
           <img alt="" src="{% static 'ai_integration2/images/flags/us.png' %}"/>
          </a>
          <ul aria-labelledby="languageDropDown" class="dropdown-menu dropdown-menu-end language-dropdown">
           <li>
            <a class="dropdown-item" href="#">
             <img alt="" src="{% static 'ai_integration2/images/flags/germany.png' %}"/>
             German
            </a>
           </li>
           <li>
            <a class="dropdown-item" href="#">
             <img alt="" src="{% static 'ai_integration2/images/flags/italy.png' %}"/>
             Italian
            </a>
           </li>
           <li>
            <a class="dropdown-item" href="#">
             <img alt="" src="{% static 'ai_integration2/images/flags/china.png' %}"/>
             Chinese
            </a>
           </li>
          </ul>
         </li>
         <li class="nav-item hidden-on-mobile">
          <a class="nav-link nav-notifications-toggle" data-bs-toggle="dropdown" href="#" id="notificationsDropDown">
           4
          </a>
          <div aria-labelledby="notificationsDropDown" class="dropdown-menu dropdown-menu-end notifications-dropdown">
           <h6 class="dropdown-header">
            Notifications
           </h6>
           <div class="notifications-dropdown-list">
            <a href="#">
             <div class="notifications-dropdown-item">
              <div class="notifications-dropdown-item-image">
               <span class="notifications-badge bg-info text-white">
                <i class="material-icons-outlined">
                 campaign
                </i>
               </span>
              </div>
              <div class="notifications-dropdown-item-text">
               <p class="bold-notifications-text">
                Donec tempus nisi sed erat vestibulum, eu suscipit ex laoreet
               </p>
               <small>
                19:00
               </small>
              </div>
             </div>
            </a>
            <a href="#">
             <div class="notifications-dropdown-item">
              <div class="notifications-dropdown-item-image">
               <span class="notifications-badge bg-danger text-white">
                <i class="material-icons-outlined">
                 bolt
                </i>
               </span>
              </div>
              <div class="notifications-dropdown-item-text">
               <p class="bold-notifications-text">
                Quisque ligula dui, tincidunt nec pharetra eu, fringilla quis mauris
               </p>
               <small>
                18:00
               </small>
              </div>
             </div>
            </a>
            <a href="#">
             <div class="notifications-dropdown-item">
              <div class="notifications-dropdown-item-image">
               <span class="notifications-badge bg-success text-white">
                <i class="material-icons-outlined">
                 alternate_email
                </i>
               </span>
              </div>
              <div class="notifications-dropdown-item-text">
               <p>
                Nulla id libero mattis justo euismod congue in et metus
               </p>
               <small>
                yesterday
               </small>
              </div>
             </div>
            </a>
            <a href="#">
             <div class="notifications-dropdown-item">
              <div class="notifications-dropdown-item-image">
               <span class="notifications-badge">
                <img alt="" src="{% static 'ai_integration2/images/avatars/avatar.png' %}"/>
               </span>
              </div>
              <div class="notifications-dropdown-item-text">
               <p>
                Praesent sodales lobortis velit ac pellentesque
               </p>
               <small>
                yesterday
               </small>
              </div>
             </div>
            </a>
            <a href="#">
             <div class="notifications-dropdown-item">
              <div class="notifications-dropdown-item-image">
               <span class="notifications-badge">
                <img alt="" src="{% static 'ai_integration2/images/avatars/avatar.png' %}"/>
               </span>
              </div>
              <div class="notifications-dropdown-item-text">
               <p>
                Praesent lacinia ante eget tristique mattis. Nam sollicitudin velit sit amet auctor porta
               </p>
               <small>
                yesterday
               </small>
              </div>
             </div>
            </a>
           </div>
          </div>
         </li>
        </ul>
       </div>
      </div>
     </nav>
    </div>
    <div class="app-content">
     <div class="content-wrapper">
      <div class="container-fluid">
       <div class="row">
        <div class="col">
         <div class="page-description page-description-tabbed">
          <h1>
           Manage AI Assistants
          </h1>
          <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
           <li class="nav-item" role="presentation">
            <button aria-controls="hoaccountme" aria-selected="true" class="nav-link active" data-bs-target="#account" data-bs-toggle="tab" id="account-tab" role="tab" type="button">
             Create New Assistant
            </button>
           </li>
           <li class="nav-item" role="presentation">
            <button class="nav-link" id="edit-tab" data-bs-toggle="tab" data-bs-target="#edit" type="button" role="tab" aria-controls="edit" aria-selected="false">
              Edit Bot
            </button>
          </li>          
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="ManageBots-tab"
              data-bs-toggle="tab"
              data-bs-target="#ManageBots"
              type="button"
              role="tab"
              aria-controls="ManageBots"
              aria-selected="false">
              Manage Bots
            </button>
          </li>
          
           <li class="nav-item" role="presentation">
            <button aria-controls="integrations" aria-selected="false" class="nav-link" data-bs-target="#integrations" data-bs-toggle="tab" id="integrations-tab" role="tab" type="button">
             Integrations
            </button>
           </li>
          </ul>
         </div>
        </div>
       </div>
       <div class="row">
        <div class="col">
         <div class="tab-content" id="myTabContent">
          
          <div aria-labelledby="account-tab" class="tab-pane fade show active" id="account" role="tabpanel">
            <form method="post" action="{% url 'ai_integration_create_bot' %}" enctype="multipart/form-data">
              {% csrf_token %}
            
              <div class="card">
                <div class="card-body">
                  <!-- Step 1: Basic Info -->
                  <div class="row">
                    <div class="col-md-6">
                      <label class="form-label" for="botName">Chatbot Name</label>
                      <input class="form-control" id="botName" name="botName" placeholder="e.g. LunaAI" type="text" required />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label" for="botDescription">Short Description</label>
                      <input class="form-control" id="botDescription" name="botDescription" placeholder="What does your bot do?" type="text" />
                    </div>
                  </div>
            
                  <!-- Step 2: Personality -->
                  <div class="row m-t-lg">
                    <div class="col-md-6">
                      <label class="form-label" for="botPersonality">Select Personality</label>
                      <select class="form-control" id="botPersonality" name="template">
                        {% for template in templates %}
                          <option value="{{ template.id }}">{{ template.name }}</option>
                        {% endfor %}
                      </select>
                      
                    </div>
                  </div>
            
                  <!-- Step 3: Documents or URLs -->
                  <div class="row m-t-lg">
                    <div class="col-md-6">
                      <label class="form-label" for="companyDocs">Upload Company Documents</label>
                      <input class="form-control mb-3" id="companyDocs" name="companyDocs" type="file" multiple />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label" for="crawlUrls">Or Enter URLs to Crawl</label>
                      <input class="form-control" id="crawlUrls" name="crawlUrls" placeholder="https://example.com" type="url" />
                    </div>
                  </div>
            
                  <!-- Step 4: Tone and Behavior -->
                  <div class="row m-t-lg">
                    <div class="col-md-6">
                      <label class="form-label" for="botTone">Set Chatbot Tone</label>
                      <select class="form-control" id="botTone" name="botTone">
                        <option value="Professional">Professional</option>
                        <option value="Friendly">Friendly</option>
                        <option value="Witty">Witty</option>
                        <option value="Empathetic">Empathetic</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label" for="botBehavior">Behavior Notes</label>
                      <textarea class="form-control" id="botBehavior" name="botBehavior" placeholder="How should your chatbot behave?" rows="2"></textarea>
                    </div>
                  </div>
            
                  <!-- Submit -->
                  <div class="row m-t-lg">
                    <div class="col text-end">
                      <button class="btn btn-primary" type="submit">Save and Train</button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
            </div>

            <div class="tab-pane fade" id="edit" role="tabpanel" aria-labelledby="edit-tab">
              <div class="card">
                <div class="card-body">
                  <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="bot_id" />
            
                    <!-- Step 1: Basic Info -->
                    <div class="row">
                      <div class="col-md-6">
                        <label class="form-label" for="editBotName">Chatbot Name</label>
                        <input class="form-control" id="editBotName" name="name" placeholder="e.g. LunaAI" type="text" required />
                      </div>
                      <div class="col-md-6">
                        <label class="form-label" for="editBotDescription">Short Description</label>
                        <input class="form-control" id="editBotDescription" name="description" placeholder="What does your bot do?" type="text" />
                      </div>
                    </div>
            
                    <!-- Step 2: Personality -->
                    <div class="row m-t-lg">
                      <div class="col-md-6">
                        <label class="form-label" for="editBotTemplate">Select Personality</label>
                        <select class="form-control" id="editBotTemplate" name="template">
                          {% for template in templates %}
                            <option value="{{ template.id }}">{{ template.name }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
            
                    <!-- Step 3: Upload/URL (Optional for Edit) -->
                    <div class="row m-t-lg">
                      <div class="col-md-6">
                        <label class="form-label" for="editCompanyDocs">Upload Company Documents</label>
                        <input class="form-control mb-3" id="editCompanyDocs" name="companyDocs" type="file" multiple />
                      </div>
                      <div class="col-md-6">
                        <label class="form-label" for="editCrawlUrls">Or Enter URLs to Crawl</label>
                        <input class="form-control" id="editCrawlUrls" name="crawlUrls" placeholder="https://example.com" type="url" />
                      </div>
                    </div>
            
                    <!-- Step 4: Tone and Behavior -->
                    <div class="row m-t-lg">
                      <div class="col-md-6">
                        <label class="form-label" for="editBotTone">Set Chatbot Tone</label>
                        <select class="form-control" id="editBotTone" name="custom_tone">
                          <option value="Professional">Professional</option>
                          <option value="Friendly">Friendly</option>
                          <option value="Witty">Witty</option>
                          <option value="Empathetic">Empathetic</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label" for="editBotBehavior">Behavior Notes</label>
                        <textarea class="form-control" id="editBotBehavior" name="behavior_notes" placeholder="How should your chatbot behave?" rows="2"></textarea>
                      </div>
                    </div>
            
                    <!-- Submit -->
                    <div class="row m-t-lg">
                      <div class="col text-end">
                        <button type="submit" class="btn btn-success">Update Bot</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            

            
            


          
            <div aria-labelledby="Manage Bots-tab" class="tab-pane fade" id="ManageBots" role="tabpanel">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Manage Your AI Assistants</h5>
                  <p class="text-muted">These are the bots you've created. You can edit them, delete them, or assign documents for training.</p>
            
                  {% if bots %}
                    <div class="list-group">
                      {% for bot in bots %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <div>
                            <h6 class="mb-0">{{ bot.name }}</h6>
                            <small class="text-muted">{{ bot.description|default:"No description yet." }}</small>
                          </div>
                          <div class="d-flex gap-2">
                            <!-- Edit Button -->
                            <a href="#" class="btn btn-sm btn-outline-primary edit-bot-btn"
                               data-id="{{ bot.id }}"
                               data-name="{{ bot.name }}"
                               data-description="{{ bot.description }}"
                               data-template="{{ bot.template.id }}"
                               data-tone="{{ bot.custom_tone }}">
                              Edit
                            </a>
            
                            <!-- Delete Button Trigger -->
                            <button type="button" class="btn btn-sm btn-outline-danger"
                                    data-bs-toggle="modal"
                                    data-bs-target="#confirmDeleteModal{{ bot.id }}">
                              Delete
                            </button>
                          </div>
                        </div>
            
                        <!-- Delete Confirmation Modal -->
                        <div class="modal fade" id="confirmDeleteModal{{ bot.id }}" tabindex="-1"
                             role="dialog" aria-labelledby="confirmDeleteLabel{{ bot.id }}" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                              <form method="post" action="{% url 'ai_integration_delete_bot' bot.id %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                  <h5 class="modal-title" id="confirmDeleteLabel{{ bot.id }}">Confirm Deletion</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                  Are you sure you want to delete <strong>{{ bot.name }}</strong>?
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                                  <button type="submit" class="btn btn-danger">Delete</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
            
                      {% endfor %}
                    </div>
                  {% else %}
                    <p class="text-muted">
                      You havenâ€™t created any bots yet.
                      <a href="{% url 'ai_integration_create_bot' %}">Create one here</a>.
                    </p>
                  {% endif %}
                </div>
              </div>
            
            </div>
            <!-- Integration Settings UI -->
            <div class="tab-pane fade" id="integrations" role="tabpanel" aria-labelledby="integrations-tab">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Widget Integration</h5>
                  <p class="text-muted">Customize the look and behavior of your embedded AI chat assistant.</p>
            
                  <!-- Widget Configuration Controls -->
                  <div class="row mb-4">
                    <div class="col-md-6">
                      <div class="form-group mb-3">
                        <label for="botSelector">Select Your Bot</label>
                        <select id="botSelector">
                          {% for bot in bots %}
                            <option value="{{ bot.id }}" data-name="{{ bot.name }}">{{ bot.name }}</option>
                          {% endfor %}
                        </select>
                        
                      </div>
            
                      <div class="form-group mb-3">
                        <label for="widgetPosition">Widget Position</label>
                        <select class="form-control" id="widgetPosition">
                          <option value="bottom-left">Bottom Left</option>
                          <option value="bottom-right">Bottom Right</option>
                        </select>
                      </div>
            
                      <div class="form-group mb-3">
                        <label for="widgetTheme">Theme</label>
                        <select class="form-control" id="widgetTheme">
                          <option value="light">Light</option>
                          <option value="dark">Dark</option>
                        </select>
                      </div>
            
                      <div class="form-group mb-3">
                        <label for="headerColor">Header Color</label>
                        <input type="color" class="form-control form-control-color" id="headerColor" value="#025450">
                      </div>
            
                      <div class="form-group mb-3">
                        <label for="botColor">Bot Message Color</label>
                        <input type="color" class="form-control form-control-color" id="botColor" value="#f1f1f1">
                      </div>
            
                      <div class="form-group mb-3">
                        <label for="userColor">User Message Color</label>
                        <input type="color" class="form-control form-control-color" id="userColor" value="#d1f3f0">
                      </div>
                    </div>
            
                    <!-- Live Preview -->
                    <div class="col-md-6">
                      <div class="chat-widget-preview light bottom-left" id="chatWidgetPreview">
                        <div class="chat-header">Chat with Luna</div>
                        <div class="chat-body">
                          <div class="bot-message">Hi there! How can I help you today?</div>
                          <div class="user-message">What services do you offer?</div>
                          <div class="bot-message">We provide smart AI integrations for your business needs.</div>
                        </div>
                        <div class="chat-footer">
                          <input type="text" placeholder="Type your message...">
                          <button>Send</button>
                        </div>
                      </div>
                    </div>
                  </div>
            
                  <p><strong>Embed Code</strong></p>
                  <pre><code id="embedScript" class="bg-light p-3 rounded d-block"></code></pre>
                </div>
              </div>
            </div>

            
            </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <!-- Javascripts -->

  <script>
    document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".edit-bot-btn").forEach(button => {
    button.addEventListener("click", function (e) {
      e.preventDefault();

      // Data
      const botId = this.dataset.id;
      const botName = this.dataset.name;
      const botDescription = this.dataset.description;
      const botTemplate = this.dataset.template;
      const botTone = this.dataset.tone;

      // Switch to Edit tab
      const editTab = document.querySelector("#edit-tab");
      new bootstrap.Tab(editTab).show();

      // Fill the form
      document.querySelector("input[name='bot_id']").value = botId;
      document.querySelector("#editBotName").value = botName;
      document.querySelector("#editBotDescription").value = botDescription;
      document.querySelector("#editBotTemplate").value = botTemplate;
      document.querySelector("#editBotTone").value = botTone;
      document.querySelector("#editBotBehavior").value = ''; // Optional: preload if you pass behavior_notes
    });
  });
});

//integration tab 
const botSelector = document.getElementById('botSelector');
  const positionSelect = document.getElementById('widgetPosition');
  const themeSelect = document.getElementById('widgetTheme');
  const headerColorPicker = document.getElementById('headerColor');
  const botColorPicker = document.getElementById('botColor');
  const userColorPicker = document.getElementById('userColor');
  const preview = document.getElementById('chatWidgetPreview');
  const embedScript = document.getElementById('embedScript');

  function updatePreviewAndScript() {
    const botId = botSelector.value;
    const botName = botSelector.options[botSelector.selectedIndex].getAttribute('data-name') || botSelector.options[botSelector.selectedIndex].text;
    const position = positionSelect.value;
    const theme = themeSelect.value;
    const headerColor = headerColorPicker.value;
    const botColor = botColorPicker.value;
    const userColor = userColorPicker.value;

    // Update preview container
    preview.className = `chat-widget-preview ${position} ${theme}`;

    // Update chat header with bot name and color
    const headerEl = preview.querySelector('.chat-header');
    headerEl.textContent = `Chat with ${botName}`;
    headerEl.style.backgroundColor = headerColor;

    // Update bubble colors
    preview.querySelectorAll('.bot-message').forEach(el => el.style.backgroundColor = botColor);
    preview.querySelectorAll('.user-message').forEach(el => el.style.backgroundColor = userColor);

    // Generate embed script
    embedScript.textContent = `<iframe 
  src="https://yourdomain.com/embed/bot/${botId}?position=${position}&theme=${theme}&headerColor=${encodeURIComponent(headerColor)}&botColor=${encodeURIComponent(botColor)}&userColor=${encodeURIComponent(userColor)}" 
  style="width: 360px; height: 520px; border: none; position: fixed; bottom: 20px; ${position === 'bottom-right' ? 'right' : 'left'}: 20px; z-index: 9999;">
</iframe>`;
  }

  // Attach event listeners
  [botSelector, positionSelect, themeSelect, headerColorPicker, botColorPicker, userColorPicker].forEach(el => {
    el.addEventListener('change', updatePreviewAndScript);
    el.addEventListener('input', updatePreviewAndScript);
  });

  // Initial call
  updatePreviewAndScript();
    </script>
    
  <script src="{% static 'ai_integration2/plugins/jquery/jquery-3.5.1.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/plugins/bootstrap/js/popper.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/plugins/bootstrap/js/bootstrap.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/plugins/perfectscroll/perfect-scrollbar.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/plugins/pace/pace.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/plugins/highlight/highlight.pack.js' %}">
  </script>
  <script src="{% static 'ai_integration2/plugins/select2/js/select2.full.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/js/main.min.js' %}">
  </script>
  <script src="{% static 'ai_integration2/js/custom.js' %}">
  </script>
  <script src="{% static 'ai_integration2/js/pages/settings.js' %}">
  </script>
 </body>
</html>